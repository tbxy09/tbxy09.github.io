__CEP__这个东西进入中国也有一段时日了，还没听过哪个公司真的用到了复杂事件处理这个功能的（事件流处理倒是挺常用）

另一方面，国内市场当前的技术水平和欧美比确实不高，举个简单的例子，CTP之类的期货柜台的原生API只支持交易所的1档行情，也就是仅能看到best bid/ask，深度行情目前只有中金所和大商所两家提供，几十万一年的直通接入价格已经足够毙掉绝大部分市场参与者了（不要跟我说文华几千块的转发行情，那玩意一来速度没法保证，另外还没法行情落地、只能用它的脚本语言，真心不知道能有多大用）。然后由于深度行情使用的API和常规软件对接的柜台还不一样，因此很多软件商压根就没考虑（没技术、没资金）去连接，想自己开发的公司也需要非常大的前期投入，不是大型机构一般都不会做的。其他的时间切片行情，股票柜台的超慢行情（6秒）等等就不去吐槽了


对国内金融市场的结构（政策、历史、市场参与者特点）没有一个很好的了解，这个了解是很难通过看资料、询问人来建立的，必须依赖自己多年参与在市场中的积累。举个例子，像我那个同事的波

中信证券

国信证券
市值排名靠前，盈利能力较强 42.59 1966 股价快速过高，恐遭机构抛售 
银河证券
传统经纪业务强势 42.69 未在A股上市 新兴业务能力不强 
广发证券
投行业务突出 46.34 1555 经纪业务排名靠后 
海通证券
营业收入、市值排名都暂列第二 67.14 2213 新兴业务能力有待增强 
华泰证券
新兴业务方面：两融业务突出 43.2 1457 业绩过分倚重两融，经纪业务继续受制于佣金率下滑 
国泰君安
营业规模较大 59.61 未在A股上市 未在A股上市，限制了补充资本金做大做强  
招商证券
市值较大，投行保持综合竞争力收入较去年翻两番 36.01 1571 经纪业务有所下降，未有突出领先业务

DemoEngine里面一个响应函数里面调用查询函数时候，出来结果不正确（延时导致）

你用什么数据库，做什么类型的查询
不要在回掉函数里面做耗时太久的操作，最好是在事件引擎里注册处理函数，让事件处理线程去操作



title: Python量化交易平台开发教程系列7-顶层GUI界面开发（1） 
date: 2015-06-23 16:20:00 
categories: 教程
tags:原创文章，转载请注明出处：用Python的交易员
前言终于有时间来写第一篇顶层GUI界面开发相关的教程了，之前实在是事情太多，跟各位读者抱个歉。整合底层接口的各项功能到中层引擎中后，当我们开发顶层应用时（GUI或者策略算法），只需知道中层引擎对外提供的主动API函数以及事件引擎中相关的事件类型和数据形式即可。在GUI和策略算法这两个主要类型的顶层应用中，作者选择先介绍GUI开发的原因是：目前国内支持用户定制化开发GUI界面的量化平台少之又少，而包含一个比较全面的GUI开发教程的则据我所知还没有。随着国内越来越多的衍生品推出（期权、分级基金、未来的反向基金），很多新型的交易策略从全自动转向了半自动，经常需要交易员的手动干预（启动暂停策略、盘中微调参数等），以及投资组合层面的风险管理（期权希腊值、分级基金行业暴露等），这种情况下传统上仅支持策略算法开发的量化交易平台变得越发难以满足交易员的需求（包括作者本人），所以估计这方面的文章更能填补当前市场需求的空缺（笑…）。
PyQt目前Python上主要的GUI开发工具包括：tkinter、PyQt、PyGTK和wxPython，笔者选择PyQt的主要原因是：
Anaconda中已经包含（早期版本中包含的是LGPL协议的Pyside，稳定性不如PyQt）

另一个内置GUI库tkinter的功能太弱
网上对这四款GUI开发工具比较分析的文章很多，有兴趣的读者可以自己搜搜看。接下来的几篇GUI开发教程会假设读者已经对PyQt开发有了一定的了解，主要针对和量化交易平台开发相关的部分，需要补充基础知识的读者建议参考以下资源：
zetcode.com，上面的教程简单明了，从头到尾做一遍对PyQt的工作原理基本就有个全面的了解了

Rapid GUI Programming with Python and Qt，一本由Riverbank（PyQt的开发公司）员工推出的PyQt开发教程，非常细致全面，但是部分内容跳跃性太大，需要从头到尾多看几遍

也可以在遇到特定问题时搜百度或者StackOverflow，通常都能找到答案
PyQt版本 
在Riverbank官网下载：PyQt4-4.11.4-gpl-Py2.7-Qt4.8.7-x32.exe Windows 32 bit installer请特别注意这个版本的问题，从最近几个月的经验看，很多PyQt相关模块运行时报错就是因为下错了版本（PyQt5、64位等等都不对）。
GUI组件从功能上看，所有交易平台的GUI组件都可以分为两类，数据监控（被动）和功能调用（主动），当然也有同时混合两类功能的组件。数据监控 

行情监控组件，用于监控实时行情数据，每当API端有新的行情数据推送时立即进行更新。功能调用 
 
账号登录组件，用于调用中层引擎的登录功能，传入用户名、密码、服务器地址等参数。混合（交易下单） 
 
交易下单组件，左侧部分用于填入下单参数后调用中层引擎的下单功能发单，右侧部分用于监控用户输入的合约代码的实时行情（有行情推送时立即更新）。
数据监控组件数据监控组件主要用于对交易平台中的各项数据实现实时更新或者手动更新的显示监控，最常用的包括行情、报单、成交、持仓和日志等。监控组件中最常见的类型是表格，对应PyQt中的QTableWidget组件，表格中的单元格则使用QTableWidgetItem组件。对于某些特殊的数据监控也可以使用其他类型的组件，如上面交易下单组件中右侧的部分，主要是使用标签组件QLabel构成的。针对不同的监控内容需要实现不同的数据更新方法，例如日志、成交类数据应该使用插入更新（即每条新的数据都应该插入新的一行），行情数据应该使用固定位置更新（即在表格中固定的单元格位置更新数据），以及主要针对持仓和报单数据的混合更新（即已经存在的数据直接在对应的位置更新，否则插入新的一行）。下面以最基础的日志监控为例介绍监控组件的实现原理，其他更为复杂的监控组件建议用户直接阅读vn.demo中demoMain.py的源代码，大部分代码作者都做了详尽的注释。
日志监控日志监控组件主要用于输出程序运行过程中有关当前程序运行状态的信息。整个实现代码如下：
########################################################################classLogMonitor(QtGui.QTableWidget):"""用于显示日志"""signal = QtCore.pyqtSignal(type(Event()))#----------------------------------------------------------------------def__init__(self, eventEngine, parent=None):"""Constructor"""super(LogMonitor, self).__init__(parent)        self.__eventEngine = eventEngine        self.initUi()        self.registerEvent()#----------------------------------------------------------------------definitUi(self):"""初始化界面"""self.setWindowTitle(u'日志')        self.setColumnCount(2)                             self.setHorizontalHeaderLabels([u'时间',u'日志'])        self.verticalHeader().setVisible(False)# 关闭左边的垂直表头self.setEditTriggers(QtGui.QTableWidget.NoEditTriggers)# 设为不可编辑状态# 自动调整列宽self.horizontalHeader().setResizeMode(0, QtGui.QHeaderView.ResizeToContents)        self.horizontalHeader().setResizeMode(1, QtGui.QHeaderView.Stretch)#----------------------------------------------------------------------defregisterEvent(self):"""注册事件监听"""# Qt图形组件的GUI更新必须使用Signal/Slot机制，否则有可能导致程序崩溃# 因此这里先将图形更新函数作为Slot，和信号连接起来# 然后将信号的触发函数注册到事件驱动引擎中self.signal.connect(self.updateLog)        self.__eventEngine.register(EVENT_LOG, self.signal.emit)#----------------------------------------------------------------------defupdateLog(self, event):"""更新日志"""# 获取当前时间和日志内容t = time.strftime('%H:%M:%S',time.localtime(time.time()))           log = event.dict_['log']# 在表格最上方插入一行self.insertRow(0)# 创建单元格cellTime = QtGui.QTableWidgetItem(t)            cellLog = QtGui.QTableWidgetItem(log)# 将单元格插入表格self.setItem(0,0, cellTime)                    self.setItem(0,1, cellLog)
在创建该GUI组件时，我们需要传入程序中的策略引擎对象，


交易软件，包括文华财经、大智慧、同花顺、快期、万德、TB、MC



ETF500 ETF800 ETF180 注入资本
回购 大股东增持
IC1507的一个大空单


IF1007和约现在是2718.2，一手的价值=2718.2×300=81.54万，保证金比例大概15%，买卖一手需要保证金=81.54×15%=12.23万


龙虎榜

成发科技


